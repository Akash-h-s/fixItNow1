{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\akash\\\\desktop\\\\mern-auth-project\\\\client\\\\src\\\\components\\\\TrackWorker.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport L from 'leaflet';\n\n// Fix for marker icons in Leaflet\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst defaultIcon = L.icon({\n  iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',\n  iconSize: [25, 41],\n  iconAnchor: [12, 41]\n});\nL.Marker.prototype.options.icon = defaultIcon;\nconst TrackWorker = ({\n  worker,\n  fullScreen = false\n}) => {\n  _s();\n  const [workerCoords, setWorkerCoords] = useState(null);\n  const [userCoords, setUserCoords] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n\n  // Generates a nearby coordinate without using .toFixed before calculation\n  const generateNearbyCoords = (lat, lng) => {\n    const offsetLat = Math.random() * 0.01 - 0.005; // +/- 0.005\n    const offsetLng = Math.random() * 0.01 - 0.005;\n    return {\n      lat: lat + offsetLat,\n      lng: lng + offsetLng\n    };\n  };\n  const fetchCoordinates = async () => {\n    try {\n      setLoading(true);\n\n      // 1. Worker coordinates\n      if (!(worker !== null && worker !== void 0 && worker.location)) {\n        setError('Worker location not provided.');\n        return;\n      }\n      const workerRes = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(worker.location)}&format=json&limit=1`);\n      const workerData = await workerRes.json();\n      if (!workerData.length) {\n        setError('Worker location not found on map.');\n        return;\n      }\n      const wCoords = {\n        lat: parseFloat(workerData[0].lat),\n        lng: parseFloat(workerData[0].lon)\n      };\n      setWorkerCoords(wCoords);\n\n      // 2. User location from localStorage\n      const storedUser = localStorage.getItem('user');\n      if (!storedUser) {\n        setError('User not logged in.');\n        return;\n      }\n      const user = JSON.parse(storedUser);\n      if (!(user !== null && user !== void 0 && user.location)) {\n        setError('User location not found.');\n        return;\n      }\n      const userRes = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(user.location)}&format=json&limit=1`);\n      const userData = await userRes.json();\n      if (!userData.length) {\n        setError('User location not found on map.');\n        return;\n      }\n      let uCoords = {\n        lat: parseFloat(userData[0].lat),\n        lng: parseFloat(userData[0].lon)\n      };\n\n      // 3. If city same, apply offset to avoid marker collision\n      const userCity = user.location.toLowerCase().split(' ')[0];\n      const workerCity = worker.location.toLowerCase().split(' ')[0];\n      if (userCity === workerCity) {\n        uCoords = generateNearbyCoords(wCoords.lat, wCoords.lng);\n      }\n      setUserCoords(uCoords);\n    } catch (err) {\n      console.error('Geocoding error:', err);\n      setError('Failed to fetch coordinates.');\n    } finally {\n      setLoading(false);\n    }\n  };\n  useEffect(() => {\n    fetchCoordinates();\n  }, [worker]);\n  if (loading) return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: 20,\n      textAlign: 'center'\n    },\n    children: \"Loading map...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 23\n  }, this);\n  if (error) return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: 20,\n      color: 'red',\n      textAlign: 'center'\n    },\n    children: error\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 21\n  }, this);\n  if (!workerCoords) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      height: '100vh',\n      width: '100vw',\n      margin: 0,\n      padding: 0\n    },\n    children: /*#__PURE__*/_jsxDEV(MapContainer, {\n      center: [workerCoords.lat, workerCoords.lng],\n      zoom: 13,\n      style: {\n        height: '100%',\n        width: '100%'\n      },\n      children: [/*#__PURE__*/_jsxDEV(TileLayer, {\n        url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n        attribution: \"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a>\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(Marker, {\n        position: [workerCoords.lat, workerCoords.lng],\n        children: /*#__PURE__*/_jsxDEV(Popup, {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: worker.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 41\n          }, this), worker.location]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 7\n      }, this), userCoords && /*#__PURE__*/_jsxDEV(Marker, {\n        position: [userCoords.lat, userCoords.lng],\n        children: /*#__PURE__*/_jsxDEV(Popup, {\n          children: \"Your Location\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 5\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 3\n  }, this);\n};\n_s(TrackWorker, \"ldV+X1N9RcvVrxKkDIqGaMcRADk=\");\n_c = TrackWorker;\nexport default TrackWorker;\nvar _c;\n$RefreshReg$(_c, \"TrackWorker\");","map":{"version":3,"names":["React","useEffect","useState","MapContainer","TileLayer","Marker","Popup","L","jsxDEV","_jsxDEV","defaultIcon","icon","iconUrl","iconSize","iconAnchor","prototype","options","TrackWorker","worker","fullScreen","_s","workerCoords","setWorkerCoords","userCoords","setUserCoords","loading","setLoading","error","setError","generateNearbyCoords","lat","lng","offsetLat","Math","random","offsetLng","fetchCoordinates","location","workerRes","fetch","encodeURIComponent","workerData","json","length","wCoords","parseFloat","lon","storedUser","localStorage","getItem","user","JSON","parse","userRes","userData","uCoords","userCity","toLowerCase","split","workerCity","err","console","style","padding","textAlign","children","fileName","_jsxFileName","lineNumber","columnNumber","color","height","width","margin","center","zoom","url","attribution","position","name","_c","$RefreshReg$"],"sources":["C:/Users/akash/desktop/mern-auth-project/client/src/components/TrackWorker.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport L from 'leaflet';\r\n\r\n// Fix for marker icons in Leaflet\r\nconst defaultIcon = L.icon({\r\n  iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',\r\n  iconSize: [25, 41],\r\n  iconAnchor: [12, 41],\r\n});\r\nL.Marker.prototype.options.icon = defaultIcon;\r\n\r\nconst TrackWorker = ({ worker, fullScreen = false }) => {\r\n  const [workerCoords, setWorkerCoords] = useState(null);\r\n  const [userCoords, setUserCoords] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n\r\n  // Generates a nearby coordinate without using .toFixed before calculation\r\n  const generateNearbyCoords = (lat, lng) => {\r\n    const offsetLat = Math.random() * 0.01 - 0.005; // +/- 0.005\r\n    const offsetLng = Math.random() * 0.01 - 0.005;\r\n    return {\r\n      lat: lat + offsetLat,\r\n      lng: lng + offsetLng,\r\n    };\r\n  };\r\n\r\n  const fetchCoordinates = async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      // 1. Worker coordinates\r\n      if (!worker?.location) {\r\n        setError('Worker location not provided.');\r\n        return;\r\n      }\r\n\r\n      const workerRes = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(worker.location)}&format=json&limit=1`);\r\n      const workerData = await workerRes.json();\r\n      if (!workerData.length) {\r\n        setError('Worker location not found on map.');\r\n        return;\r\n      }\r\n\r\n      const wCoords = {\r\n        lat: parseFloat(workerData[0].lat),\r\n        lng: parseFloat(workerData[0].lon),\r\n      };\r\n      setWorkerCoords(wCoords);\r\n\r\n      // 2. User location from localStorage\r\n      const storedUser = localStorage.getItem('user');\r\n      if (!storedUser) {\r\n        setError('User not logged in.');\r\n        return;\r\n      }\r\n\r\n      const user = JSON.parse(storedUser);\r\n      if (!user?.location) {\r\n        setError('User location not found.');\r\n        return;\r\n      }\r\n\r\n      const userRes = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(user.location)}&format=json&limit=1`);\r\n      const userData = await userRes.json();\r\n      if (!userData.length) {\r\n        setError('User location not found on map.');\r\n        return;\r\n      }\r\n\r\n      let uCoords = {\r\n        lat: parseFloat(userData[0].lat),\r\n        lng: parseFloat(userData[0].lon),\r\n      };\r\n\r\n      // 3. If city same, apply offset to avoid marker collision\r\n      const userCity = user.location.toLowerCase().split(' ')[0];\r\n      const workerCity = worker.location.toLowerCase().split(' ')[0];\r\n      if (userCity === workerCity) {\r\n        uCoords = generateNearbyCoords(wCoords.lat, wCoords.lng);\r\n      }\r\n\r\n      setUserCoords(uCoords);\r\n    } catch (err) {\r\n      console.error('Geocoding error:', err);\r\n      setError('Failed to fetch coordinates.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchCoordinates();\r\n  }, [worker]);\r\n\r\n  if (loading) return <div style={{ padding: 20, textAlign: 'center' }}>Loading map...</div>;\r\n  if (error) return <div style={{ padding: 20, color: 'red', textAlign: 'center' }}>{error}</div>;\r\n  if (!workerCoords) return null;\r\n\r\n return (\r\n  <div style={{ height: '100vh', width: '100vw', margin: 0, padding: 0 }}>\r\n    <MapContainer\r\n      center={[workerCoords.lat, workerCoords.lng]}\r\n      zoom={13}\r\n      style={{ height: '100%', width: '100%' }}\r\n    >\r\n      <TileLayer\r\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n        attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\r\n      />\r\n      <Marker position={[workerCoords.lat, workerCoords.lng]}>\r\n        <Popup>\r\n          <strong>{worker.name}</strong><br />\r\n          {worker.location}\r\n        </Popup>\r\n      </Marker>\r\n\r\n      {userCoords && (\r\n        <Marker position={[userCoords.lat, userCoords.lng]}>\r\n          <Popup>Your Location</Popup>\r\n        </Marker>\r\n      )}\r\n    </MapContainer>\r\n  </div>\r\n);\r\n\r\n};\r\n\r\nexport default TrackWorker;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}